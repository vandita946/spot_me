
    <%= render partial: "shared/goal_edit", locals: {goal: @goal} %>

    <div class="container justify-content-center">
      <div class="goal-head">
        <div class="goal-details">
        <h1>
          <%= @goal.title %>
          <br>
          <i id="title-icon" class="fa fa-<%= @goal.icon %> mb-3"></i>
          <br>
            <a id="edit-icon" href="blank" data-toggle="modal" data-target="#goal-edit" >
              <i class="fas fa-edit"></i>
            </a>
        </h1>
        <p> <%= @goal.status %> </p>
        <h6> <%= @goal.description %> </h6>

        </div>
        <div id="goal-buddies">
        <% buddies = @goal.get_goal_buddies(current_user)[:goal_buddies] %>
        <% requested = @goal.get_goal_buddies(current_user)[:requested] %>
        <% if buddies.empty? && requested.empty? %>
            <p>You don't have anyone to keep you accountable, yet!</p>
            <%= render partial: "shared/add_buddy", locals: {goal: @goal, goal_connection: @goal_connection} %>
            <button class="btn btn-primary" data-toggle="modal" data-target="#add_buddy" >
              Add one now!
            </button>
        <% else %>
          <% if buddies.length == 1 %>
            <p>Your buddy is:
          <% elsif buddies.length > 1 %>
            <p>Your buddies are:
          <% end %>

            <% buddies.each do |buddy| %>
              <%= buddy.firstname %>
            <% end %>
          </p>

          <% if requested.length >= 1 %>
            <p>You've requested:</p>
            <% requested.each do |req| %>
              <%= req.firstname %>
            <% end %>
          <% end %>

        <% end %>

        </div>
      </div>

        <div class="container d-flex flex-grow-1 justify-content-center">

          <div class="row">
            <div class="col-2">
              <div class="progress progress-bar-vertical">
              <div class="progress-bar" role="progressbar" style="height: <%= @goal.progress %>%" role="progressbar" aria-valuenow="<%= @goal.progress %>" aria-valuemin="0" aria-valuemax="100">
              </div>
              </div>
            </div>

            <div class="col">
            <div class="cards-container">
              <% @milestones.each do |milestone| %>
                <%= render partial: 'shared/completion_message', locals: { milestone: milestone, completion_message: @completion_message } %>
                <%= render partial: "shared/milestones_edit_form", locals: {milestone: milestone} %>
                <div class="card" style="width: 30rem;">
                  <div class="card-body">
                    <h2 class="card-title mb-0"> <%= milestone.name %></h2>

                    <% if milestone.is_completed %>
                      <%= form_for milestone, remote: true do |f| %>
                        <%= f.hidden_field :is_completed, value: false %>
                        <button class="btn" type="submit">
                          <i class="far fa-check-square"></i>
                        </button>
                      <% end %>

                      <h6 id="completion-bubble"><%= milestone.completion_message.content %></h6>
                    <% else %>
                    <button class="btn" id="completion" data-toggle="modal" data-target="#completion-<%=milestone.id%>" >
                      <i class="far fa-square"></i>
                      </button>
                    <% end %>
                    <p class='card-subtitle'> <%= milestone.deadline.strftime("%A, %-d/%-m/%y") %></p>
                        <div class="stars">
                        <% milestone.weightage.times do %>
                            <i class="fas fa-star"></i>
                        <% end %>
                        <% (5 - milestone.weightage).times do %>
                          <i class="far fa-star"></i>
                        <% end %>
                        </div>

                    <a id="edit" href="blank" data-toggle="modal" data-target="#edit-<%=milestone.id%>" >
                    <i class="far fa-edit"></i>
                    </a>
                  </div>
                  </div>
              <% end %>
            </div>
            </div>
          </div>

        </div>


      <%= render partial: "shared/new_milestone", locals: {goal: @goal, milestone: Milestone.new} %>

    <% if @milestones.empty? %>
      <strong class="container d-flex justify-content-center">You have no milestones yet, time to add some!</strong>
    <% end %>
    <div class="container d-flex justify-content-center mt-3">

      <a id="milestone-add" href="blank" data-toggle="modal" data-target="#new-milestone" >
        <i id="add-milestone" class="fas fa-plus justify-content-center"></i>
      </a>
    </div>


    </br>



    <%# Chatroom for the goal %>
    <div class="container">
    <h2> Chat </h2>
    <div id="messages" data-chatroom-id="<%= @chatroom.id %>">
      <% @chatroom.messages.each do |message| %>
        <div class="message-container" id="message-<%= message.id %>">
          <i class="author">
            <span><%= message.user.firstname %></span>
            <small><%= message.created_at.strftime("%a %b %e at %l:%M%p") %></small>
          </i>
          <p><%= message.content %></p>
        </div>
      <% end %>
    </div>
    <%= simple_form_for [ @chatroom, @message ], remote: true do |f| %>
      <%= f.input :content, label: false, placeholder: "What's on your mind?" %>
      <%= f.button :submit, "Send message", class: "btn btn-primary" %>
    <% end %>

    </div>



    <%# LOGIC GATES HERE %>
    <% if @user.nil? %>


    <!-- Development use only: Button trigger modal -->
    <%# <button type="button" class="btn btn-primary my-3" data-toggle="modal" data-target="#staticBackdrop">
      Launch static backdrop modal
    </button> %>

      <!-- Modal -->
      <div class="modal fade notauser" id="staticBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header d-flex justify-content-center">
              <h5 class="modal-title" id="staticBackdropLabel">Register as a user to view the goal</h5>
              <%# <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button> %>
            </div>
            <div class="modal-body">
              To view the goal, please register or login as a user. <br> <br>
              To be a buddy, please register or login as a user. <br> <br>
              User, user, user, user, user, user, <br>
              user, user, user, user, user, user, <br>
              user, user, user, user, user, user, <br>
              user, user, user, joel, user, user, <br>
              user, user, user, user, user, user, <br>
              user, user, user, user, user, user, <br>
              user, user, user, user, user, user, <br>
            </div>
            <div class="modal-footer d-flex justify-content-center">
              <%= link_to :back do %>
                <button type="button" class="btn btn-link">Go back</button>
              <% end %>
              <%# <%= link_to "< Go Back", :back %>

              <%= link_to new_user_session_path do %>
                <button type="button" class="btn btn-secondary mx-3">Sign In</button>
              <% end %>

              <%= link_to new_user_registration_path(goal: @goal) do %>
                <button type="button" class="btn btn-primary">Register</button>
              <% end %>

              <%# <button type="button" class="btn btn-secondary" data-dismiss="modal">Home</button> %>
              <%# <button type="button" class="btn btn-primary">Understood</button> %>
            </div>
          </div>
        </div>
      </div>

    <% end %>

